# links:

https://docker.crank.ru/docs/docker-compose/controlling-startup-order/ - Controlling startup order in Compose;

# Basic part

Вы можете управлять порядком запуска службы с помощью параметра depends_on. Compose всегда запускает контейнеры в порядке зависимостей, где зависимости определяются `depends_on`, `links`, `volume_from` и `network_mode: "service: ..."`.


Однако Compose не будет ждать, пока контейнер будет «готов» (что бы это ни значило для вашего конкретного приложения) - только до тех пор, пока он не запустится. Для этого есть веская причина.


Проблема ожидания готовности базы данных (например) на самом деле является лишь подмножеством гораздо более крупной проблемы распределенных систем. В производственной среде ваша база данных может стать недоступной или переместить хосты в любое время. Ваше приложение должно быть устойчивым к сбоям такого типа.


Чтобы справиться с этим, ваше приложение должно попытаться восстановить соединение с базой данных после сбоя. Если приложение попытается установить соединение, оно в конечном итоге сможет подключиться к базе данных.

Лучшее решение - выполнить эту проверку в коде приложения как при запуске, так и при потере соединения по какой-либо причине. Однако, если вам не нужен такой уровень устойчивости, вы можете обойти проблему с помощью скрипта-оболочки:


 - Используйте такой инструмент, как wait-for-it(https://github.com/vishnubob/wait-for-it) или dockerize(https://github.com/jwilder/dockerize). Это небольшие сценарии-оболочки, которые вы можете включить в образ своего приложения и будут опрашивать данный хост и порт, пока он не примет TCP-соединения.

Предположим, что для образа вашего приложения в Dockerfile установлен CMD, вы можете обернуть его, установив точку входа в docker-compose.yml:

<img width="683" alt="Screenshot 2021-07-23 at 12 41 10" src="https://github.com/DaDvoy/Inception/blob/basicPart/srcs/informationDockerCompose/Screen%20Shot%202021-11-28%20at%207.25.51%20PM.png">

 - Напишите свой собственный сценарий оболочки, чтобы выполнить проверку работоспособности для конкретного приложения. Например, вы можете подождать, пока Postgres определенно не будет готов принимать команды:

<img width="683" alt="Screenshot 2021-07-23 at 12 41 10" src="https://github.com/DaDvoy/Inception/blob/basicPart/srcs/informationDockerCompose/Screen%20Shot%202021-11-28%20at%207.25.59%20PM.png">

Вы можете использовать это как сценарий оболочки, как в предыдущем примере, установив точку входа: ./wait-for-postgres.sh db.
