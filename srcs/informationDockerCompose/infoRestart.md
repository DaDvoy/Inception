# links:
https://andreyex.ru/linux/rukovodstvo-dlya-nachinayushhih-po-politike-perezapuska-docker/ - Руководство для начинающих по политике перезапуска Docker;


# Basic part:

Политики перезапуска Docker применяются для каждого контейнера. Есть два способа назначить контейнеру политику перезапуска. Вы можете установить его в файле YAML, если собираетесь использовать Docker Compose, Swarm или Kubernetes.

Вы также можете установить политику перезапуска прямо в командной строке при запуске контейнера:

docker container run --restart <policy>


**Политики перезапуска докеров**

Существуют следующие политики перезапуска контейнеров Docker:

 - no: по умолчанию контейнеры не запускаются автоматически.
 - always: всегда перезапускать остановленный контейнер, если контейнер не был остановлен явно
 - unless-stopped: перезапустить контейнер, если контейнер не был в остановленном состоянии до остановки демона Docker (объяснено позже).
 - on-failure: перезапустите контейнер, если он завершился с ненулевым кодом выхода или если демон докера перезапустился.

Как мы уже упоминали, если вы явно не добавите политику перезапуска, она будет иметь значение «no», что означает, что контейнеры не будут перезапущены автоматически.

*Политика перезапуска always*

Начнем с политики перезапуска always. Если эта политика установлена, контейнер всегда будет перезапускаться, если он не был остановлен явно.

*Политика перезапуска unless-stopped vs always*

unless-stopped похоже на политику перезагрузки always. Оба перезапускают контейнеры автоматически, и если вы остановите контейнеры явно, они не перезапустятся.

Но основное различие между ними заключается в том, что если вы остановите контейнеры с помощью команды docker stop, а затем перезапустите демон docker, контейнер с политикой перезапуска always запустит контейнер автоматически, но контейнер с политикой unless-stopped не будет перезапущен.

Покажу это на примерах. У меня уже есть остановленный контейнер с политикой постоянного перезапуска. Позвольте мне создать новый контейнер с именем except-stop-policy с политикой unless-stopped.


*Политика перезапуска on-failure*
Политика перезапуска on-failure перезапускает контейнер, если он был завершен с ненулевым кодом выхода (указывающим на ошибку/сбой). Он также перезапускает контейнеры, если перезапускается демон docker, включая те, которые ранее находились в остановленном состоянии.

Если вы вручную остановите контейнер с помощью команды docker stop, он будет существовать с нулевым кодом, указывающим, что все было нормально.